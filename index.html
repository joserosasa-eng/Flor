<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’ Abre Tu CorazÃ³n</title>
    <meta name="description" content="Una sorpresa especial de San ValentÃ­n">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Inter:wght@300;400;600&family=Dancing+Script:wght@400;700&display=swap" rel="stylesheet">
    <style>
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        :root{
            --rose-100:#ffe4e6;--rose-200:#fecdd3;--rose-300:#fda4af;--rose-400:#fb7185;
            --rose-500:#f43f5e;--rose-600:#e11d48;--rose-700:#be123c;--rose-800:#9f1239;
            --gold-400:#facc15;--gold-500:#eab308;
            --wine:#4a0e1b;--deep-wine:#2d0a11;--midnight:#0f0a15;
        }
        body{font-family:'Inter',sans-serif;background:var(--midnight);min-height:100vh;
            overflow:hidden;position:relative;user-select:none}

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SCENE SYSTEM & TRANSITIONS
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .scene{position:fixed;top:0;left:0;width:100%;height:100%;
            display:flex;align-items:center;justify-content:center;
            opacity:0;pointer-events:none;z-index:1;
            transition:opacity 2.5s cubic-bezier(.4,0,.2,1)}
        .scene.active{opacity:1;pointer-events:all;z-index:10}
        .scene.fading-out{opacity:0;pointer-events:none;z-index:5;
            transition:opacity 2s cubic-bezier(.4,0,.2,1)}

        /* Magic transition overlay */
        .magic-transition{position:fixed;top:0;left:0;width:100%;height:100%;
            z-index:100;pointer-events:none;opacity:0;
            transition:opacity 1.5s ease}
        .magic-transition.active{opacity:1}
        .magic-transition canvas{width:100%;height:100%}

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SHARED BACKGROUND
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .bg-gradient{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;
            background:
                radial-gradient(ellipse at 20% 50%,rgba(190,18,60,0.15) 0%,transparent 60%),
                radial-gradient(ellipse at 80% 20%,rgba(244,63,94,0.1) 0%,transparent 50%),
                radial-gradient(ellipse at 50% 80%,rgba(74,14,27,0.3) 0%,transparent 60%),
                linear-gradient(180deg,var(--midnight) 0%,var(--deep-wine) 50%,var(--midnight) 100%)}
        canvas#particles-canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1;pointer-events:none}

        .hearts-container{position:fixed;top:0;left:0;width:100%;height:100%;
            pointer-events:none;z-index:2;overflow:hidden}
        .floating-heart{position:absolute;bottom:-60px;opacity:0;animation:floatHeart linear infinite;filter:blur(1px)}
        @keyframes floatHeart{
            0%{transform:translateY(0) translateX(0) rotate(0deg) scale(.5);opacity:0}
            10%{opacity:.5}50%{opacity:.25}90%{opacity:.08}
            100%{transform:translateY(-110vh) translateX(100px) rotate(360deg) scale(.2);opacity:0}}

        /* Gear decorations */
        .gear-decoration{position:fixed;border-radius:50%;border:3px solid rgba(251,113,133,0.12);
            z-index:2;pointer-events:none}
        .gear-decoration::after{content:'';position:absolute;top:-8px;left:-8px;right:-8px;bottom:-8px;
            border-radius:50%;background:repeating-conic-gradient(from 0deg,rgba(251,113,133,0.06) 0deg 10deg,transparent 10deg 20deg)}
        .gear-1{width:200px;height:200px;top:-50px;left:-50px;animation:rotG 20s linear infinite}
        .gear-2{width:150px;height:150px;bottom:-30px;right:-30px;animation:rotG 15s linear infinite reverse}
        .gear-3{width:120px;height:120px;top:20%;right:5%;animation:rotG 25s linear infinite}
        .gear-4{width:100px;height:100px;bottom:15%;left:8%;animation:rotG 18s linear infinite}
        @keyframes rotG{from{transform:rotate(0)}to{transform:rotate(360deg)}}

        /* Mechanism rings around lock */
        .mechanism-ring{position:absolute;border-radius:50%;border:1px solid rgba(251,113,133,0.08);
            pointer-events:none;animation:ringPulse 4s ease-in-out infinite}
        .mechanism-ring:nth-child(1){width:280px;height:280px;top:50%;left:50%;
            transform:translate(-50%,-50%);animation-delay:0s}
        .mechanism-ring:nth-child(2){width:340px;height:340px;top:50%;left:50%;
            transform:translate(-50%,-50%);animation-delay:1s;border-style:dashed}
        .mechanism-ring:nth-child(3){width:400px;height:400px;top:50%;left:50%;
            transform:translate(-50%,-50%);animation-delay:2s}
        .ring-dot{position:absolute;width:6px;height:6px;border-radius:50%;background:var(--rose-500);
            box-shadow:0 0 10px rgba(244,63,94,0.4);opacity:.5}
        @keyframes ringPulse{0%,100%{opacity:.3;transform:translate(-50%,-50%) scale(1)}
            50%{opacity:.6;transform:translate(-50%,-50%) scale(1.02)}}

        @keyframes gradShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
        @keyframes pulse{0%,100%{opacity:.5}50%{opacity:1}}

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SCENE 1: LOCK
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .lock-wrap{display:flex;flex-direction:column;align-items:center;gap:30px;padding:40px;
            animation:cFadeIn 1.5s ease-out}
        @keyframes cFadeIn{from{opacity:0;transform:translateY(30px) scale(.95)}to{opacity:1;transform:translateY(0) scale(1)}}
        .lock-title{text-align:center}
        .lock-title h1{font-family:'Dancing Script',cursive;font-size:clamp(2rem,5vw,3.5rem);font-weight:700;
            background:linear-gradient(135deg,var(--rose-300),var(--rose-500),var(--gold-400));
            background-size:200% 200%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;
            background-clip:text;animation:gradShift 4s ease-in-out infinite}
        .lock-title p{font-size:.85rem;color:var(--rose-400);margin-top:8px;font-weight:300;
            letter-spacing:4px;text-transform:uppercase;opacity:.7}
        .shackle{width:120px;height:70px;border:8px solid rgba(251,113,133,0.3);border-bottom:none;
            border-radius:60px 60px 0 0;margin-bottom:-5px;
            transition:all 1s cubic-bezier(.68,-.55,.265,1.55);
            filter:drop-shadow(0 0 15px rgba(244,63,94,0.2))}
        .shackle::before,.shackle::after{content:'';position:absolute;bottom:-12px;width:12px;height:25px;
            background:rgba(251,113,133,0.3);border-radius:3px}
        .shackle::before{left:-4px}.shackle::after{right:-4px}
        .shackle.unlocked{transform:translateY(-20px) rotate(-20deg);transform-origin:right bottom;
            border-color:var(--gold-400);filter:drop-shadow(0 0 30px rgba(234,179,8,0.5))}
        .shackle.unlocked::before,.shackle.unlocked::after{background:var(--gold-400)}
        .padlock{position:relative;display:flex;flex-direction:column;align-items:center}
        .lock-body{width:200px;height:140px;background:linear-gradient(145deg,rgba(74,14,27,0.9),rgba(45,10,17,0.95));
            border-radius:16px;border:2px solid rgba(251,113,133,0.2);
            display:flex;flex-direction:column;align-items:center;justify-content:center;gap:15px;
            position:relative;overflow:hidden;
            box-shadow:0 20px 60px rgba(0,0,0,0.5),0 0 40px rgba(244,63,94,0.1),inset 0 1px 0 rgba(255,255,255,0.05);
            transition:all .6s ease}
        .lock-body::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;
            background:linear-gradient(90deg,transparent,rgba(255,255,255,.03),transparent);animation:shimmer 3s ease-in-out infinite}
        @keyframes shimmer{0%,100%{left:-100%}50%{left:100%}}
        .keyhole{position:absolute;top:12px;width:20px;height:20px}
        .keyhole-circle{width:14px;height:14px;border-radius:50%;border:2px solid rgba(251,113,133,0.4);margin:0 auto}
        .keyhole-slot{width:6px;height:10px;background:rgba(251,113,133,0.3);margin:-2px auto 0;border-radius:0 0 3px 3px}
        .dials-container{display:flex;gap:6px;z-index:2}
        .dial{width:38px;height:60px;background:linear-gradient(180deg,rgba(15,10,21,0.9),rgba(45,10,17,0.8),rgba(15,10,21,0.9));
            border-radius:8px;border:1.5px solid rgba(251,113,133,0.25);position:relative;overflow:hidden;
            cursor:pointer;transition:border-color .3s,box-shadow .3s}
        .dial:hover{border-color:var(--rose-400);box-shadow:0 0 20px rgba(244,63,94,0.2)}
        .dial::before,.dial::after{content:'';position:absolute;left:0;right:0;height:1px;z-index:3}
        .dial::before{top:18px;background:linear-gradient(90deg,transparent,var(--rose-400),transparent);opacity:.4}
        .dial::after{bottom:18px;background:linear-gradient(90deg,transparent,var(--rose-400),transparent);opacity:.4}
        .dial-numbers{position:absolute;top:0;left:0;width:100%;transition:transform .3s cubic-bezier(.34,1.56,.64,1)}
        .dial-number{width:100%;height:24px;display:flex;align-items:center;justify-content:center;
            font-family:'Playfair Display',serif;font-size:1rem;font-weight:700;color:rgba(253,164,175,0.4);transition:all .3s}
        .dial-number.active{color:var(--rose-300);text-shadow:0 0 20px rgba(244,63,94,0.6);font-size:1.15rem}
        .dial-number.correct{color:var(--gold-400)!important;text-shadow:0 0 25px rgba(234,179,8,0.6)!important}
        .dial-indicator{position:absolute;top:50%;left:0;right:0;transform:translateY(-50%);height:24px;
            background:rgba(244,63,94,0.05);border-top:1px solid rgba(244,63,94,0.15);
            border-bottom:1px solid rgba(244,63,94,0.15);z-index:2;pointer-events:none}
        .dial-notch{position:absolute;top:50%;transform:translateY(-50%);width:4px;height:8px;
            background:var(--rose-500);border-radius:2px;z-index:4;opacity:.6}
        .dial-notch.left{left:-1px;border-radius:0 2px 2px 0}.dial-notch.right{right:-1px;border-radius:2px 0 0 2px}
        .lock-status{display:flex;gap:8px;margin-top:5px}
        .status-dot{width:8px;height:8px;border-radius:50%;background:var(--rose-700);
            transition:all .5s;box-shadow:0 0 10px rgba(244,63,94,0.3)}
        .status-dot.active{background:var(--gold-400);box-shadow:0 0 20px rgba(234,179,8,0.5)}
        .hint-text{text-align:center;font-size:.75rem;color:rgba(253,164,175,0.5);
            letter-spacing:2px;text-transform:uppercase;margin-top:15px;animation:pulse 2s ease-in-out infinite}
        .instruction-text{font-family:'Dancing Script',cursive;text-align:center;font-size:1.1rem;
            color:var(--rose-300);margin-top:5px;opacity:.6}

        /* Unlock overlay */
        .unlock-overlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:50;
            display:none;align-items:center;justify-content:center;flex-direction:column;
            background:rgba(15,10,21,0.9);pointer-events:none}
        .unlock-overlay.active{display:flex;animation:fadeIn 1s ease-out}
        @keyframes fadeIn{from{opacity:0}to{opacity:1}}
        .unlock-msg{font-family:'Dancing Script',cursive;font-size:clamp(2.5rem,8vw,4rem);
            background:linear-gradient(135deg,var(--gold-400),var(--rose-300));
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
            animation:unlockPop 1s cubic-bezier(.34,1.56,.64,1) both}
        @keyframes unlockPop{from{opacity:0;transform:scale(.3) rotate(-10deg)}
            to{opacity:1;transform:scale(1) rotate(0)}}
        .unlock-sub{font-size:1rem;color:var(--rose-300);opacity:.7;margin-top:10px;
            letter-spacing:3px;animation:fadeIn 1.5s ease-out .5s both}
        .flash-effect{position:fixed;top:0;left:0;width:100%;height:100%;z-index:49;
            background:radial-gradient(circle,rgba(234,179,8,0.3),transparent 70%);
            pointer-events:none;opacity:0;animation:flashPulse 1.5s ease-out forwards}
        @keyframes flashPulse{0%{opacity:1;transform:scale(.5)}100%{opacity:0;transform:scale(2)}}

        /* Burst hearts */
        .burst-heart{position:fixed;pointer-events:none;z-index:55;font-size:2rem;
            animation:burstOut 2s ease-out forwards}
        @keyframes burstOut{0%{opacity:1;transform:translate(0,0) scale(0)}
            30%{opacity:1;transform:translate(var(--tx),var(--ty)) scale(1.2)}
            100%{opacity:0;transform:translate(var(--tx2),var(--ty2)) scale(.3)}}

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SCENE 2: VINYL
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .vinyl-scene{display:flex;flex-direction:column;align-items:center;gap:28px;padding:20px}
        .scene-title h1{font-family:'Dancing Script',cursive;font-size:clamp(1.8rem,5vw,3rem);font-weight:700;text-align:center;
            background:linear-gradient(135deg,var(--rose-300),var(--rose-500),var(--gold-400));
            background-size:200% 200%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;
            background-clip:text;animation:gradShift 4s ease-in-out infinite}
        .scene-title p{font-size:.8rem;color:var(--rose-400);text-align:center;
            letter-spacing:3px;text-transform:uppercase;margin-top:6px;opacity:.5}
        .turntable{position:relative;width:min(380px,88vw);height:min(380px,88vw)}
        .turntable::before{content:'';position:absolute;top:-8px;left:-8px;right:-8px;bottom:-8px;
            border-radius:50%;border:1px solid rgba(251,113,133,0.08);pointer-events:none}
        .vinyl-wrapper{width:100%;height:100%;filter:drop-shadow(0 0 50px rgba(244,63,94,0.12))}
        canvas#vinyl{width:100%;height:100%;border-radius:50%}
        .needle-ptr{position:absolute;top:-20px;left:50%;transform:translateX(-50%);width:0;height:0;
            border-left:15px solid transparent;border-right:15px solid transparent;border-top:26px solid var(--gold-400);
            filter:drop-shadow(0 4px 15px rgba(234,179,8,0.5));z-index:20;transition:filter .15s}
        .needle-ptr.tick{filter:drop-shadow(0 4px 25px rgba(234,179,8,1))}
        .tonearm{position:absolute;top:-10px;right:-35px;width:90px;height:150px;
            transform-origin:top right;transform:rotate(-25deg);
            transition:transform 1s cubic-bezier(.68,-.55,.265,1.55);z-index:15}
        .tonearm-bar{width:4px;height:100%;background:linear-gradient(180deg,#666,#333);
            border-radius:2px;margin-left:auto;margin-right:12px;box-shadow:0 0 10px rgba(0,0,0,.6)}
        .tonearm-head{width:12px;height:18px;background:#555;border-radius:0 0 4px 4px;
            margin-left:auto;margin-right:8px;margin-top:-2px;box-shadow:0 2px 8px rgba(0,0,0,.5)}
        .tonearm.playing{transform:rotate(-5deg)}
        .vinyl-hub{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
            width:90px;height:90px;border-radius:50%;z-index:20;cursor:pointer;
            background:radial-gradient(circle at 40% 35%,rgba(244,63,94,0.9),var(--deep-wine) 80%);
            border:3px solid rgba(251,113,133,0.3);
            box-shadow:0 0 30px rgba(244,63,94,0.25),0 0 60px rgba(244,63,94,0.1),
                inset 0 -3px 10px rgba(0,0,0,0.4),inset 0 3px 10px rgba(255,255,255,0.05);
            display:flex;align-items:center;justify-content:center;flex-direction:column;transition:all .3s}
        .vinyl-hub:hover{transform:translate(-50%,-50%) scale(1.08);border-color:var(--rose-400);
            box-shadow:0 0 40px rgba(244,63,94,0.4),0 0 80px rgba(244,63,94,0.15),inset 0 -3px 10px rgba(0,0,0,0.4)}
        .vinyl-hub:active{transform:translate(-50%,-50%) scale(.95)}
        .vinyl-hub.disabled{pointer-events:none;opacity:.5}
        .hub-heart{font-size:2.2rem;line-height:1;animation:heartPulse 2s ease-in-out infinite}
        .hub-text{font-size:.55rem;color:var(--rose-200);letter-spacing:2px;text-transform:uppercase;margin-top:3px;opacity:.7;font-weight:600}

        /* Result overlay for vinyl */
        .result-overlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;
            display:none;align-items:center;justify-content:center;flex-direction:column;
            background:rgba(15,10,21,0.95)}
        .result-overlay.active{display:flex;animation:fadeIn .6s ease-out}
        .result-content{text-align:center;animation:resultPop .8s cubic-bezier(.34,1.56,.64,1) .3s both}
        @keyframes resultPop{from{opacity:0;transform:scale(.5)}to{opacity:1;transform:scale(1)}}
        .result-vinyl-icon{width:120px;height:120px;border-radius:50%;margin:0 auto 20px;
            background:conic-gradient(from 0deg,#1a1a2e,#16213e,#0f0a15,#1a1a2e);
            border:3px solid rgba(251,113,133,0.2);box-shadow:0 0 40px rgba(244,63,94,0.15);
            display:flex;align-items:center;justify-content:center;
            animation:spinDisc 3s linear infinite}
        .result-vinyl-icon.flying{
            position:fixed !important;z-index:1100;margin:0;pointer-events:none;
            transition:all 3s cubic-bezier(.25,.1,.25,1);
            box-shadow:0 0 60px rgba(244,63,94,0.3),0 0 120px rgba(244,63,94,0.1)}
        .result-hole{width:20px;height:20px;border-radius:50%;background:var(--midnight);
            border:2px solid rgba(251,113,133,0.3)}
        .result-song{font-family:'Dancing Script',cursive;font-size:clamp(2rem,6vw,3.5rem);
            background:linear-gradient(135deg,var(--gold-400),var(--rose-300));
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;
            margin-bottom:8px}
        .result-artist{font-size:1rem;color:var(--rose-300);letter-spacing:2px;opacity:.7;margin-bottom:30px}
        .eq-bars{display:flex;gap:3px;align-items:flex-end;height:25px;justify-content:center;margin-bottom:8px}
        .eq-bar{width:4px;background:var(--rose-500);border-radius:2px;animation:eqBars 1s ease-in-out infinite}
        .eq-bar:nth-child(1){animation-delay:0s;height:10px}
        .eq-bar:nth-child(2){animation-delay:.15s;height:18px}
        .eq-bar:nth-child(3){animation-delay:.3s;height:12px}
        .eq-bar:nth-child(4){animation-delay:.1s;height:22px}
        .eq-bar:nth-child(5){animation-delay:.25s;height:8px}
        @keyframes eqBars{0%,100%{transform:scaleY(1)}50%{transform:scaleY(.3)}}
        .result-label{font-size:.7rem;color:var(--rose-400);letter-spacing:4px;text-transform:uppercase;opacity:.6}
        @keyframes heartPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.15)}}

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           SCENE 3: VIDEO
        â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .video-bg{position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:0}
        .video-overlay{position:absolute;top:0;left:0;width:100%;height:100%;z-index:1;
            background:linear-gradient(180deg,rgba(0,0,0,0.6) 0%,rgba(15,10,21,0.4) 30%,rgba(15,10,21,0.4) 70%,rgba(0,0,0,0.7) 100%)}
        .video-vignette{position:absolute;top:0;left:0;width:100%;height:100%;z-index:2;
            background:radial-gradient(ellipse at center,transparent 50%,rgba(0,0,0,0.5) 100%)}
        .s3-content{position:relative;z-index:10;display:flex;flex-direction:column;align-items:center;
            text-align:center;padding:20px 20px 100px;max-width:650px;width:100%;
            opacity:0;animation:s3In 3s ease-out 1s forwards;
            max-height:100vh;overflow-y:auto;overflow-x:hidden;
            scrollbar-width:none;-ms-overflow-style:none}
        .s3-content::-webkit-scrollbar{display:none}
        @keyframes s3In{from{opacity:0;transform:translateY(40px)}to{opacity:1;transform:translateY(0)}}

        /* â”€â”€ Lily decoration â”€â”€ */
        .lily-wrap{position:relative;width:min(650px,95vw);height:min(650px,95vw);margin:-20px auto -30px;flex-shrink:0;
            filter:drop-shadow(0 0 60px rgba(255,180,210,0.5)) drop-shadow(0 0 120px rgba(244,63,94,0.3))}
        #lily-canvas{width:100%;height:100%}
        .lily-glow{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
            width:400px;height:400px;border-radius:50%;pointer-events:none;
            background:radial-gradient(circle,rgba(255,200,220,0.3) 0%,transparent 70%);
            animation:lilyGlow 3s ease-in-out infinite}
        @keyframes lilyGlow{0%,100%{opacity:.6;transform:translate(-50%,-50%) scale(1)}50%{opacity:1;transform:translate(-50%,-50%) scale(1.15)}}

        .s3-content h1{font-family:'Dancing Script',cursive;font-size:clamp(2.2rem,6vw,3.8rem);font-weight:700;
            color:#fff;text-shadow:0 4px 30px rgba(0,0,0,0.6),0 0 60px rgba(244,63,94,0.2);margin-bottom:10px;line-height:1.2}
        .s3-divider{width:80px;height:2px;margin:0 auto 15px;
            background:linear-gradient(90deg,transparent,var(--rose-400),transparent);opacity:.6}
        .s3-content p{font-family:'Playfair Display',serif;font-size:clamp(.95rem,2.3vw,1.2rem);
            color:rgba(255,255,255,0.8);line-height:1.8;letter-spacing:.5px;
            text-shadow:0 2px 15px rgba(0,0,0,0.5);margin-bottom:10px}
        .s3-signature{font-family:'Dancing Script',cursive;font-size:1.5rem;color:var(--rose-300);
            margin-top:25px;opacity:0;animation:sigIn 2s ease-out 4s forwards}
        @keyframes sigIn{from{opacity:0;transform:translateY(10px)}to{opacity:.8;transform:translateY(0)}}

        /* â”€â”€ Countdown â”€â”€ */
        .countdown-section{margin:15px 0;opacity:0;animation:s3In 2s ease-out 2s forwards}
        .countdown-label{font-family:'Dancing Script',cursive;font-size:1.1rem;color:var(--rose-300);margin-bottom:10px;opacity:.8}
        .countdown-boxes{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
        .cd-box{background:rgba(244,63,94,0.12);border:1px solid rgba(251,113,133,0.2);
            border-radius:12px;padding:10px 14px;min-width:65px;
            backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}
        .cd-num{font-family:'Playfair Display',serif;font-size:1.8rem;font-weight:900;
            background:linear-gradient(135deg,var(--rose-300),var(--gold-400));
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1}
        .cd-unit{font-size:.6rem;color:var(--rose-400);letter-spacing:2px;text-transform:uppercase;margin-top:3px;opacity:.7}
        .cd-arrived{font-family:'Dancing Script',cursive;font-size:1.6rem;
            color:var(--gold-400);text-shadow:0 0 20px rgba(234,179,8,0.4)}

        /* â”€â”€ Valentine Question â”€â”€ */
        .vq-section{margin:20px 0;opacity:0;animation:s3In 2s ease-out 3s forwards}
        .vq-question{font-family:'Dancing Script',cursive;font-size:clamp(1.4rem,4vw,2rem);
            color:#fff;margin-bottom:18px;text-shadow:0 2px 20px rgba(0,0,0,0.5)}
        .vq-buttons{display:flex;gap:20px;justify-content:center;align-items:center;
            position:relative;min-height:60px}
        .btn-si{padding:14px 40px;font-family:'Dancing Script',cursive;font-size:1.3rem;font-weight:700;
            background:linear-gradient(135deg,var(--rose-500),var(--rose-600));
            color:#fff;border:none;border-radius:50px;cursor:pointer;
            box-shadow:0 4px 25px rgba(244,63,94,0.4),0 0 40px rgba(244,63,94,0.15);
            transition:all .3s ease;letter-spacing:1px;position:relative;z-index:5}
        .btn-si:hover{transform:scale(1.08);box-shadow:0 6px 35px rgba(244,63,94,0.5),0 0 60px rgba(244,63,94,0.2)}
        .btn-si:active{transform:scale(.95)}
        .btn-no{padding:12px 30px;font-family:'Inter',sans-serif;font-size:1rem;
            background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.5);
            border:1px solid rgba(255,255,255,0.15);border-radius:50px;cursor:pointer;
            transition:all .25s ease;position:relative;z-index:4}
        .btn-no:hover{background:rgba(255,255,255,0.04)}
        @keyframes shakeNo{0%,100%{transform:translateX(0)}15%{transform:translateX(-8px) rotate(-2deg)}30%{transform:translateX(8px) rotate(2deg)}45%{transform:translateX(-6px)}60%{transform:translateX(6px)}75%{transform:translateX(-3px)}}
        .no-msg{font-family:'Inter',sans-serif;font-size:.8rem;color:var(--rose-400);
            margin-top:8px;min-height:20px;opacity:0;transition:opacity .4s ease}
        .no-msg.show{opacity:1}

        /* â”€â”€ Love Message Reveal â”€â”€ */
        .love-reveal{position:fixed;top:0;left:0;width:100%;height:100%;z-index:200;
            display:none;align-items:center;justify-content:center;flex-direction:column;
            background:rgba(15,10,21,0.95);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
            overflow-y:auto;padding:30px 20px}
        .love-reveal.active{display:flex}
        .love-content{text-align:center;max-width:550px;animation:lovePop 1s cubic-bezier(.34,1.56,.64,1) both}
        @keyframes lovePop{from{opacity:0;transform:scale(.5) translateY(30px)}to{opacity:1;transform:scale(1) translateY(0)}}
        .love-hearts-burst{font-size:3rem;margin-bottom:15px;animation:heartPulse 1.5s ease-in-out infinite}
        .love-name{font-family:'Dancing Script',cursive;font-size:clamp(2.5rem,7vw,4rem);
            background:linear-gradient(135deg,var(--rose-300),var(--gold-400),var(--rose-400));
            background-size:200% 200%;-webkit-background-clip:text;-webkit-text-fill-color:transparent;
            background-clip:text;animation:gradShift 3s ease-in-out infinite;margin-bottom:20px}
        @keyframes gradShift{0%,100%{background-position:0% 50%}50%{background-position:100% 50%}}
        .love-msg{font-family:'Playfair Display',serif;font-size:clamp(1rem,2.5vw,1.2rem);
            color:rgba(255,255,255,0.85);line-height:2;letter-spacing:.5px;
            text-shadow:0 2px 15px rgba(0,0,0,0.5);margin-bottom:20px;
            opacity:0;animation:fadeUp 2s ease-out 0.8s forwards}
        @keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .love-sign{font-family:'Dancing Script',cursive;font-size:1.4rem;color:var(--rose-300);
            opacity:0;animation:fadeUp 1.5s ease-out 2.5s forwards}
        .love-emoji-rain{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:201;overflow:hidden}
        .love-emoji-drop{position:absolute;top:-50px;font-size:1.5rem;animation:emojiRain linear forwards}
        @keyframes emojiRain{0%{opacity:1;transform:translateY(0) rotate(0)}100%{opacity:0;transform:translateY(110vh) rotate(360deg)}}

        /* â”€â”€ Hello Kitty floating decorations â”€â”€ */
        .kitty-float{position:absolute;pointer-events:none;z-index:6;opacity:0;
            animation:kittyFloat linear infinite;
            filter:drop-shadow(0 0 8px rgba(255,182,193,0.4))}
        @keyframes kittyFloat{
            0%{opacity:0;transform:translateY(10px) rotate(-3deg) scale(0.9)}
            8%{opacity:.7}40%{opacity:.55}85%{opacity:.2}
            100%{opacity:0;transform:translateY(-110vh) rotate(8deg) scale(1.05)}}

        /* â”€â”€ Fake Payment Overlay (broma) â”€â”€ */
        .payment-overlay{position:fixed;top:0;left:0;width:100%;height:100%;z-index:300;
            display:none;align-items:center;justify-content:center;
            background:rgba(15,10,21,0.97);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);
            padding:20px;overflow-y:auto}
        .payment-overlay.active{display:flex}
        .payment-card{background:linear-gradient(145deg,rgba(30,20,40,0.95),rgba(45,25,50,0.95));
            border:1px solid rgba(251,113,133,0.2);border-radius:20px;padding:30px 25px;
            max-width:420px;width:100%;animation:lovePop .6s cubic-bezier(.34,1.56,.64,1) both;
            box-shadow:0 20px 60px rgba(0,0,0,0.5),0 0 40px rgba(244,63,94,0.1)}
        .payment-title{font-family:'Dancing Script',cursive;font-size:1.6rem;color:var(--rose-300);
            text-align:center;margin-bottom:5px}
        .payment-subtitle{font-family:'Inter',sans-serif;font-size:.75rem;color:var(--rose-400);
            text-align:center;opacity:.7;margin-bottom:20px}
        .payment-amount{text-align:center;margin-bottom:20px}
        .payment-amount span{font-family:'Playfair Display',serif;font-size:2.2rem;font-weight:900;
            background:linear-gradient(135deg,var(--rose-300),var(--gold-400));
            -webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
        .payment-amount small{display:block;font-size:.7rem;color:var(--rose-400);opacity:.6;margin-top:3px}
        .pay-field{margin-bottom:14px}
        .pay-field label{display:block;font-size:.7rem;color:var(--rose-300);letter-spacing:1px;
            text-transform:uppercase;margin-bottom:5px;opacity:.7}
        .pay-field input{width:100%;padding:12px 14px;background:rgba(255,255,255,0.05);
            border:1px solid rgba(251,113,133,0.15);border-radius:10px;color:rgba(255,255,255,0.8);
            font-family:'Inter',sans-serif;font-size:.9rem;outline:none;
            transition:border-color .3s}
        .pay-field input:focus{border-color:var(--rose-400)}
        .pay-field input::placeholder{color:rgba(255,255,255,0.2)}
        .pay-row{display:flex;gap:12px}
        .pay-row .pay-field{flex:1}
        .btn-pay{width:100%;padding:14px;font-family:'Dancing Script',cursive;font-size:1.2rem;
            font-weight:700;background:linear-gradient(135deg,var(--rose-500),var(--rose-600));
            color:#fff;border:none;border-radius:50px;cursor:pointer;margin-top:8px;
            box-shadow:0 4px 25px rgba(244,63,94,0.4);transition:all .3s}
        .btn-pay:hover{transform:scale(1.03);box-shadow:0 6px 35px rgba(244,63,94,0.5)}
        .pay-footer{text-align:center;margin-top:12px;font-size:.65rem;color:var(--rose-400);opacity:.4}
        .pay-result{display:none;text-align:center;padding:20px 0}
        .pay-result.active{display:block;animation:lovePop .6s cubic-bezier(.34,1.56,.64,1) both}
        .pay-result-icon{font-size:4rem;margin-bottom:10px}
        .pay-result-msg{font-family:'Dancing Script',cursive;font-size:1.5rem;color:var(--rose-300);margin-bottom:8px}
        .pay-result-sub{font-family:'Playfair Display',serif;font-size:.95rem;color:rgba(255,255,255,0.7);line-height:1.6}
        .btn-accept-love{padding:14px 40px;font-family:'Dancing Script',cursive;font-size:1.2rem;
            font-weight:700;background:linear-gradient(135deg,var(--rose-500),var(--rose-600));
            color:#fff;border:none;border-radius:50px;cursor:pointer;margin-top:20px;
            box-shadow:0 4px 25px rgba(244,63,94,0.4);transition:all .3s}
        .btn-accept-love:hover{transform:scale(1.06)}
        .now-playing{position:absolute;bottom:0;left:0;width:100%;z-index:20;
            background:linear-gradient(180deg,transparent,rgba(0,0,0,0.8) 40%);
            padding:30px 20px 20px;display:flex;align-items:center;justify-content:center;gap:15px;
            opacity:0;animation:npIn 1.5s ease-out 2s forwards}
        @keyframes npIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
        .np-vinyl{width:40px;height:40px;border-radius:50%;flex-shrink:0;
            background:conic-gradient(from 0deg,#1a1a2e,#0f0a15,#1a1a2e);
            border:2px solid rgba(251,113,133,0.2);display:flex;align-items:center;justify-content:center;
            animation:spinDisc 3s linear infinite}
        .np-hole{width:8px;height:8px;border-radius:50%;background:#000;border:1px solid rgba(251,113,133,0.3)}
        @keyframes spinDisc{from{transform:rotate(0)}to{transform:rotate(360deg)}}
        .np-info{display:flex;flex-direction:column}
        .np-song{font-family:'Playfair Display',serif;font-size:.85rem;color:var(--rose-200);font-weight:700}
        .np-artist{font-size:.7rem;color:var(--rose-400);opacity:.6}
        .eq-mini{display:flex;gap:2px;align-items:flex-end;height:18px}
        .eq-mini .bar{width:3px;background:var(--rose-500);border-radius:1px;animation:eqB .8s ease-in-out infinite}
        .eq-mini .bar:nth-child(1){height:6px;animation-delay:0s}
        .eq-mini .bar:nth-child(2){height:14px;animation-delay:.1s}
        .eq-mini .bar:nth-child(3){height:9px;animation-delay:.2s}
        .eq-mini .bar:nth-child(4){height:16px;animation-delay:.05s}
        @keyframes eqB{0%,100%{transform:scaleY(1)}50%{transform:scaleY(.25)}}

        .petal{position:absolute;pointer-events:none;z-index:5;font-size:1.2rem;opacity:0;animation:petalFall linear infinite}
        @keyframes petalFall{
            0%{opacity:0;transform:translateY(-20px) translateX(0) rotate(0)}
            10%{opacity:.35}90%{opacity:.1}
            100%{opacity:0;transform:translateY(105vh) translateX(80px) rotate(360deg)}}

        .note-particle{position:fixed;pointer-events:none;z-index:999;font-size:1.5rem;opacity:0;
            animation:noteFloat 3s ease-out forwards}
        @keyframes noteFloat{0%{opacity:1;transform:translateY(0) rotate(0) scale(0)}
            20%{opacity:1;transform:translateY(-30px) rotate(20deg) scale(1)}
            100%{opacity:0;transform:translateY(-200px) rotate(60deg) scale(.5)}}

        /* Lock dissolve for 1â†’2 */
        .lock-wrap.dissolving{
            animation:lockDissolve 2s cubic-bezier(.4,0,.2,1) forwards}
        @keyframes lockDissolve{
            0%{opacity:1;transform:translateY(0) scale(1);filter:blur(0)}
            40%{opacity:.8;transform:translateY(-10px) scale(1.02);filter:blur(0)}
            100%{opacity:0;transform:translateY(30px) scale(.85);filter:blur(8px)}}

        /* Scene 1 smooth out */
        .scene.scene-dissolve{
            animation:sceneDissolve 2.8s cubic-bezier(.4,0,.2,1) forwards}
        @keyframes sceneDissolve{
            0%{opacity:1}60%{opacity:.4}100%{opacity:0}}

        /* Scene 2 entrance */
        .vinyl-scene.entering .scene-title{
            animation:slideUp 1.5s cubic-bezier(.16,1,.3,1) .3s both}
        .vinyl-scene.entering .turntable{
            animation:vinylAppear 2s cubic-bezier(.16,1,.3,1) .6s both}
        @keyframes slideUp{from{opacity:0;transform:translateY(50px)}to{opacity:1;transform:translateY(0)}}
        @keyframes vinylAppear{from{opacity:0;transform:translateY(80px) scale(.7)}to{opacity:1;transform:translateY(0) scale(1)}}

        /* Vinyl shrink transition for 2â†’3 */
        .result-text-fade{transition:opacity 1s ease-out;opacity:0 !important}
        .result-overlay.bg-fade{background:transparent !important;transition:background 1.5s ease-out}
        .vinyl-scene.scene-out .scene-title{
            animation:fadeSlideDown 1.2s cubic-bezier(.4,0,.2,1) forwards}
        @keyframes fadeSlideDown{to{opacity:0;transform:translateY(40px)}}

        /* Dark curtain between scenes */
        .dark-curtain{
            position:fixed;top:0;left:0;width:100%;height:100%;z-index:99;
            background:var(--midnight);opacity:0;pointer-events:none;
            transition:opacity 1.5s cubic-bezier(.4,0,.2,1)}
        .dark-curtain.active{opacity:1}

        @media(max-width:480px){
            .lock-wrap{padding:20px;gap:20px}
            .lock-body{width:170px;height:120px}.shackle{width:100px;height:55px}
            .dial{width:32px;height:52px}
            .gear-decoration{display:none}
            .turntable{width:280px;height:280px}
            .vinyl-hub{width:72px;height:72px}.hub-heart{font-size:1.8rem}
            .tonearm{display:none}
        }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    <canvas id="particles-canvas"></canvas>
    <div class="hearts-container" id="hearts-container"></div>
    <div class="gear-decoration gear-1"></div>
    <div class="gear-decoration gear-2"></div>
    <div class="gear-decoration gear-3"></div>
    <div class="gear-decoration gear-4"></div>

    <!-- â•â•â•â•â•â•â• TRANSITION OVERLAY â•â•â•â•â•â•â• -->
    <div class="magic-transition" id="magic-transition">
        <canvas id="transition-canvas"></canvas>
    </div>
    <div class="dark-curtain" id="dark-curtain"></div>

    <!-- â•â•â•â•â•â•â• SCENE 1: LOCK â•â•â•â•â•â•â• -->
    <div class="scene active" id="scene-1">
        <div class="lock-wrap">
            <div class="lock-title">
                <h1>ğŸ’Abre Tu CorazÃ³n</h1>
                <p>San ValentÃ­n 2026</p>
            </div>
            <div class="padlock" id="padlock">
                <div class="shackle" id="shackle"></div>
                <div class="lock-body" id="lock-body">
                    <div class="keyhole"><div class="keyhole-circle"></div><div class="keyhole-slot"></div></div>
                    <div class="dials-container" id="dials-container"></div>
                    <div class="lock-status">
                        <div class="status-dot" id="dot-0"></div><div class="status-dot" id="dot-1"></div>
                        <div class="status-dot" id="dot-2"></div><div class="status-dot" id="dot-3"></div>
                    </div>
                </div>
                <!-- Mechanism rings -->
                <div class="mechanism-ring"><div class="ring-dot" style="top:0;left:50%"></div><div class="ring-dot" style="bottom:0;left:50%"></div><div class="ring-dot" style="top:50%;left:0"></div><div class="ring-dot" style="top:50%;right:0"></div></div>
                <div class="mechanism-ring"><div class="ring-dot" style="top:10%;left:10%"></div><div class="ring-dot" style="top:10%;right:10%"></div><div class="ring-dot" style="bottom:10%;left:10%"></div><div class="ring-dot" style="bottom:10%;right:10%"></div></div>
                <div class="mechanism-ring"><div class="ring-dot" style="top:0;left:30%"></div><div class="ring-dot" style="top:0;right:30%"></div><div class="ring-dot" style="bottom:0;left:30%"></div><div class="ring-dot" style="bottom:0;right:30%"></div></div>
            </div>
            <p class="instruction-text">â˜ï¸ Desliza o haz click en los diales</p>
            <p class="hint-text">Recuerda que olvidaba
        </div>
    </div>

    <!-- â•â•â•â•â•â•â• UNLOCK OVERLAY â•â•â•â•â•â•â• -->
    <div class="unlock-overlay" id="unlock-overlay">
        <div class="unlock-msg">ğŸ’– Â¡Desbloqueado!</div>
        <div class="unlock-sub">Tu corazÃ³n se ha abierto...</div>
    </div>

    <!-- â•â•â•â•â•â•â• SCENE 2: VINYL â•â•â•â•â•â•â• -->
    <div class="scene" id="scene-2">
        <div class="vinyl-scene">
            <div class="scene-title">
                <h1>ğŸ¶ Elige las ondas de Tu CorazÃ³n</h1>
                <p>Toca el corazÃ³n para girar el vinilo</p>
            </div>
            <div class="turntable" id="turntable">
                <div class="needle-ptr" id="needle-ptr"></div>
                <div class="tonearm" id="tonearm">
                    <div class="tonearm-bar"></div><div class="tonearm-head"></div>
                </div>
                <div class="vinyl-wrapper"><canvas id="vinyl" width="760" height="760"></canvas></div>
                <div class="vinyl-hub" id="spin-hub">
                    <span class="hub-heart">ğŸ’–</span>
                    <span class="hub-text">Girar</span>
                </div>
            </div>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â• VINYL RESULT OVERLAY â•â•â•â•â•â•â• -->
    <div class="result-overlay" id="result-overlay">
        <div class="result-content">
            <div class="result-vinyl-icon" id="result-vinyl-icon"><div class="result-hole"></div></div>
            <div class="result-song" id="result-song"></div>
            <div class="result-artist" id="result-artist"></div>
            <div class="eq-bars"><div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div><div class="eq-bar"></div></div>
            <span class="result-label">Reproduciendo...</span>
        </div>
    </div>

    <!-- â•â•â•â•â•â•â• SCENE 3: VIDEO â•â•â•â•â•â•â• -->
    <div class="scene" id="scene-3">
        <video class="video-bg" id="video-bg" muted loop playsinline preload="auto">
            <source src="background.mp4" type="video/mp4">
        </video>
        <div class="video-overlay"></div>
        <div class="video-vignette"></div>
        <div class="s3-content" id="s3-content">
            <!-- Lily decoration -->
            <div class="lily-wrap" id="lily-wrap">
                <canvas id="lily-canvas" width="1300" height="1300"></canvas>
                <div class="lily-glow"></div>
            </div>
            <h1>Sofia,diamantinağŸ’</h1>
            <div class="s3-divider"></div>
            <p>Tengo algo muy especial que preguntarte...</p>

            <!-- Countdown -->
            <div class="countdown-section" id="countdown-section">
                <div class="countdown-label">â³ Para San ValentÃ­n...</div>
                <div class="countdown-boxes" id="countdown-boxes">
                    <div class="cd-box"><div class="cd-num" id="cd-days">0</div><div class="cd-unit">DÃ­as</div></div>
                    <div class="cd-box"><div class="cd-num" id="cd-hours">0</div><div class="cd-unit">Horas</div></div>
                    <div class="cd-box"><div class="cd-num" id="cd-mins">0</div><div class="cd-unit">Min</div></div>
                    <div class="cd-box"><div class="cd-num" id="cd-secs">0</div><div class="cd-unit">Seg</div></div>
                </div>
            </div>

            <!-- Valentine Question -->
            <div class="vq-section" id="vq-section">
                <div class="vq-question">Â¿Feliz dia de San ValentÃ­nğŸŒ¹</div>
                <div class="vq-buttons" id="vq-buttons">
                    <button class="btn-si" id="btn-si">ğŸ’– Aun quieres seguir conmigo ğŸ’–</button>
                    <button class="btn-no" id="btn-no">No ğŸ˜”</button>
                </div>
                <div class="no-msg" id="no-msg"></div>
            </div>

            <div class="s3-signature">Hecho con todo mi amor para ti ğŸ’•</div>
        </div>

        <!-- Love Message Reveal (overlay) -->
        <div class="love-reveal" id="love-reveal">
            <div class="love-emoji-rain" id="love-emoji-rain"></div>
            <div class="love-content">
                <div class="love-hearts-burst">ğŸ’–ğŸ©·ğŸ’</div>
                <div class="love-name">Te amo, Sofia</div>
                <div class="love-msg">
                    Mi corazÃ³n es tuyo y siempre lo serÃ¡. Amarte se convirtiÃ³ en algo natural en mi vida, vida mÃ­a. Eres todo para mÃ­ y cada dÃ­a despierto feliz al saber que te tengo a mi lado. Siempre estÃ¡s en mis pensamientos y cada pequeÃ±o momento que tengo a tu lado es un ladrillo en lo nuestro.
                    <br><br>
                    ğŸŒ¹ Feliz San ValentÃ­n, mi abogada hermosa ğŸŒ¹
                </div>
                <div class="love-sign">Con todo mi amor, por siempre tuyo ğŸ’</div>
            </div>
        </div>

        <!-- Fake Payment Overlay (broma) -->
        <div class="payment-overlay" id="payment-overlay">
            <div class="payment-card" id="payment-card">
                <div class="payment-title">ğŸ’³ Multa por Romper Corazones</div>
                <div class="payment-subtitle">ArtÃ­culo 14.09 del CÃ³digo del Amor: "Rechazar una invitaciÃ³n de San ValentÃ­n tiene consecuencias"</div>
                <div class="payment-amount">
                    <span>$999,999.99</span>
                    <small>Impuesto por desamor incluido ğŸ’”</small>
                </div>
                <div id="pay-form">
                    <div class="pay-field">
                        <label>ğŸ’³ NÃºmero de tarjeta</label>
                        <input type="text" placeholder="1234 5678 9012 3456" maxlength="19" id="pay-card-num">
                    </div>
                    <div class="pay-field">
                        <label>ğŸ‘¤ Nombre en la tarjeta</label>
                        <input type="text" placeholder="Sofia Rompecorazones">
                    </div>
                    <div class="pay-row">
                        <div class="pay-field">
                            <label>ğŸ“… Vencimiento</label>
                            <input type="text" placeholder="02/26" maxlength="5">
                        </div>
                        <div class="pay-field">
                            <label>ğŸ”’ CVV</label>
                            <input type="text" placeholder="â¤ï¸â¤ï¸â¤ï¸" maxlength="3">
                        </div>
                    </div>
                    <button class="btn-pay" id="btn-pay">ğŸ’˜ Pagar la multa</button>
                    <div class="pay-footer">ğŸ”’ ConexiÃ³n asegurada por Cupido S.A. de C.V.</div>
                </div>
                <div class="pay-result" id="pay-result">
                    <div class="pay-result-icon">âŒğŸ’–</div>
                    <div class="pay-result-msg">Â¡TransacciÃ³n rechazada!</div>
                    <div class="pay-result-sub">
                        Error: El amor no tiene costo.<br>
                        DiagnÃ³stico mÃ©dico: Solo necesitas decir <strong>"SÃ­"</strong><br>
                        Receta: 1 beso cada 4 horas ğŸ’Š
                    </div>
                    <button class="btn-accept-love" id="btn-accept-love">ğŸ’– EstÃ¡ bien, acepto con todo mi corazÃ³n ğŸ’–</button>
                </div>
            </div>
        </div>

        <!-- Hello Kitty floating canvases -->
        <canvas class="kitty-float" id="kitty-1" width="120" height="120"></canvas>
        <canvas class="kitty-float" id="kitty-2" width="100" height="100"></canvas>
        <canvas class="kitty-float" id="kitty-3" width="110" height="110"></canvas>
        <canvas class="kitty-float" id="kitty-4" width="90" height="90"></canvas>
        <canvas class="kitty-float" id="kitty-5" width="115" height="115"></canvas>
        <canvas class="kitty-float" id="kitty-6" width="85" height="85"></canvas>
        <canvas class="kitty-float" id="kitty-7" width="95" height="95"></canvas>
        <canvas class="kitty-float" id="kitty-8" width="105" height="105"></canvas>
        <div class="now-playing" id="now-playing">
            <div class="np-vinyl" id="np-vinyl"><div class="np-hole"></div></div>
            <div class="np-info">
                <span class="np-song" id="np-song">â€”</span>
                <span class="np-artist" id="np-artist">â€”</span>
            </div>
            <div class="eq-mini"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div>
        </div>
    </div>

    <audio id="music-player" preload="auto"></audio>

    <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  SCENE TRANSITION SYSTEM
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const transCanvas = document.getElementById('transition-canvas');
    const transCtx = transCanvas.getContext('2d');
    function resizeTrans(){transCanvas.width=innerWidth;transCanvas.height=innerHeight}
    resizeTrans(); addEventListener('resize',resizeTrans);

    function magicTransition(fromId, toId, duration=4000) {
        return new Promise(resolve => {
            const overlay = document.getElementById('magic-transition');
            const fromScene = document.getElementById(fromId);
            const toScene = document.getElementById(toId);
            const sparkles = [];

            // Create sparkle particles
            for(let i=0;i<60;i++){
                sparkles.push({
                    x:Math.random()*transCanvas.width,
                    y:Math.random()*transCanvas.height,
                    size:Math.random()*3+1,
                    speed:Math.random()*2+0.5,
                    angle:Math.random()*Math.PI*2,
                    opacity:0,
                    hue:340+Math.random()*40,
                    phase:Math.random()*Math.PI*2
                });
            }

            let start = null;
            const half = duration / 2;

            overlay.classList.add('active');

            function animate(ts) {
                if(!start) start=ts;
                const elapsed = ts-start;
                const progress = Math.min(elapsed/duration, 1);

                transCtx.clearRect(0,0,transCanvas.width,transCanvas.height);

                // Background fade: black peaks at 50%
                const bgAlpha = progress<0.5
                    ? Math.pow(progress*2, 1.5) * 0.85
                    : Math.pow((1-progress)*2, 1.5) * 0.85;
                transCtx.fillStyle=`rgba(15,10,21,${bgAlpha})`;
                transCtx.fillRect(0,0,transCanvas.width,transCanvas.height);

                // Switch scenes at midpoint
                if(elapsed >= half && fromScene.classList.contains('active')){
                    fromScene.classList.remove('active');
                    fromScene.classList.add('fading-out');
                    toScene.classList.add('active');
                }

                // Sparkles
                sparkles.forEach(s=>{
                    s.phase += 0.05;
                    s.x += Math.cos(s.angle)*s.speed;
                    s.y += Math.sin(s.angle)*s.speed - 0.5;
                    s.opacity = Math.sin(progress*Math.PI) * (0.5+Math.sin(s.phase)*0.5);

                    transCtx.beginPath();
                    transCtx.arc(s.x,s.y,s.size,0,Math.PI*2);
                    transCtx.fillStyle=`hsla(${s.hue},80%,70%,${s.opacity})`;
                    transCtx.fill();

                    // Glow
                    transCtx.beginPath();
                    transCtx.arc(s.x,s.y,s.size*3,0,Math.PI*2);
                    transCtx.fillStyle=`hsla(${s.hue},80%,70%,${s.opacity*0.15})`;
                    transCtx.fill();
                });

                if(progress<1){
                    requestAnimationFrame(animate);
                } else {
                    overlay.classList.remove('active');
                    fromScene.classList.remove('fading-out');
                    transCtx.clearRect(0,0,transCanvas.width,transCanvas.height);
                    resolve();
                }
            }
            requestAnimationFrame(animate);
        });
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  SCENE 1: COMBINATION LOCK
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const CORRECT_CODE=[2,9,0,4], TOTAL_NUMBERS=10, DH=24;
    const currentValues=[0,0,0,0];
    let isUnlocked=false;

    const dialsContainer=document.getElementById('dials-container');
    CORRECT_CODE.forEach((_,di)=>{
        const dial=document.createElement('div');dial.className='dial';dial.id=`dial-${di}`;
        const ind=document.createElement('div');ind.className='dial-indicator';dial.appendChild(ind);
        const nL=document.createElement('div');nL.className='dial-notch left';dial.appendChild(nL);
        const nR=document.createElement('div');nR.className='dial-notch right';dial.appendChild(nR);
        const strip=document.createElement('div');strip.className='dial-numbers';strip.id=`strip-${di}`;
        for(let i=-1;i<=TOTAL_NUMBERS;i++){
            const d=document.createElement('div');d.className='dial-number';
            if(i>=0&&i<TOTAL_NUMBERS){d.textContent=i;d.dataset.value=i}
            strip.appendChild(d);
        }
        dial.appendChild(strip);dialsContainer.appendChild(dial);
        const init=(60/2)-(1*DH+DH/2);strip.style.transform=`translateY(${init}px)`;
        setupDial(dial,di);
    });

    function setupDial(dial,di){
        let offset=(60/2)-(1*DH+DH/2);
        const strip=dial.querySelector('.dial-numbers');

        // Click to cycle
        dial.addEventListener('click',e=>{
            if(isUnlocked)return;
            const r=dial.getBoundingClientRect();
            if(e.clientY-r.top<30) currentValues[di]=(currentValues[di]-1+10)%10;
            else currentValues[di]=(currentValues[di]+1)%10;
            offset=(60/2)-((currentValues[di]+1)*DH+DH/2);
            strip.style.transition='transform .3s cubic-bezier(.34,1.56,.64,1)';
            strip.style.transform=`translateY(${offset}px)`;
            clickSound();updateDots();checkCode();
        });

        // Wheel
        dial.addEventListener('wheel',e=>{
            if(isUnlocked)return;e.preventDefault();
            currentValues[di]=(currentValues[di]+(e.deltaY>0?1:-1)+10)%10;
            offset=(60/2)-((currentValues[di]+1)*DH+DH/2);
            strip.style.transition='transform .3s cubic-bezier(.34,1.56,.64,1)';
            strip.style.transform=`translateY(${offset}px)`;
            clickSound();updateDots();checkCode();
        },{passive:false});

        // Touch drag support
        let touchStartY=0, touchStartVal=0;
        dial.addEventListener('touchstart',e=>{
            if(isUnlocked)return;
            touchStartY=e.touches[0].clientY;
            touchStartVal=currentValues[di];
            strip.style.transition='none';
        },{passive:true});
        dial.addEventListener('touchmove',e=>{
            if(isUnlocked)return;e.preventDefault();
            const dy=e.touches[0].clientY-touchStartY;
            const steps=Math.round(dy/DH);
            currentValues[di]=(touchStartVal+steps+100)%10;
            offset=(60/2)-((currentValues[di]+1)*DH+DH/2);
            strip.style.transform=`translateY(${offset}px)`;
            clickSound();updateDots();
        },{passive:false});
        dial.addEventListener('touchend',()=>{
            if(isUnlocked)return;
            strip.style.transition='transform .3s cubic-bezier(.34,1.56,.64,1)';
            offset=(60/2)-((currentValues[di]+1)*DH+DH/2);
            strip.style.transform=`translateY(${offset}px)`;
            checkCode();
        });
    }

    function updateDots(){
        currentValues.forEach((v,i)=>{
            const strip=document.getElementById(`strip-${i}`);
            strip.querySelectorAll('.dial-number').forEach(n=>{
                n.classList.remove('active','correct');
                if(parseInt(n.dataset.value)===v){n.classList.add('active');
                    if(v===CORRECT_CODE[i])n.classList.add('correct')}
            });
            const dot=document.getElementById(`dot-${i}`);
            v===CORRECT_CODE[i]?dot.classList.add('active'):dot.classList.remove('active');
        });
    }
    updateDots();

    function checkCode(){
        if(currentValues.every((v,i)=>v===CORRECT_CODE[i])&&!isUnlocked){
            isUnlocked=true;
            if(navigator.vibrate)navigator.vibrate([100,50,100,50,200]);

            // Shackle opens
            setTimeout(()=>{
                document.getElementById('shackle').classList.add('unlocked');
                const lb=document.getElementById('lock-body');
                lb.style.borderColor='rgba(234,179,8,0.4)';
                lb.style.boxShadow='0 20px 60px rgba(0,0,0,0.5),0 0 60px rgba(234,179,8,0.2)';
            },400);

            // Hearts burst from the lock center
            setTimeout(()=>{
                const lockRect=document.getElementById('padlock').getBoundingClientRect();
                const cx=lockRect.left+lockRect.width/2, cy=lockRect.top+lockRect.height/2;
                const emojis=['ğŸ’–','ğŸ’•','â¤ï¸','ğŸŒ¹','âœ¨','ğŸ’','ğŸ’—','ğŸ’“','ğŸ¥°','ğŸ˜'];
                for(let i=0;i<20;i++){
                    const h=document.createElement('div');h.className='burst-heart';
                    h.textContent=emojis[Math.floor(Math.random()*emojis.length)];
                    const angle=Math.random()*Math.PI*2;
                    const dist=80+Math.random()*120;
                    const dist2=150+Math.random()*200;
                    h.style.left=cx+'px';h.style.top=cy+'px';
                    h.style.setProperty('--tx',Math.cos(angle)*dist+'px');
                    h.style.setProperty('--ty',Math.sin(angle)*dist+'px');
                    h.style.setProperty('--tx2',Math.cos(angle)*dist2+'px');
                    h.style.setProperty('--ty2',(Math.sin(angle)*dist2-100)+'px');
                    h.style.fontSize=(1.2+Math.random()*1.5)+'rem';
                    h.style.animationDelay=(Math.random()*0.5)+'s';
                    document.body.appendChild(h);
                    setTimeout(()=>h.remove(),3000);
                }
            },600);

            // Flash effect
            setTimeout(()=>{
                const flash=document.createElement('div');flash.className='flash-effect';
                document.body.appendChild(flash);setTimeout(()=>flash.remove(),2000);
            },500);

            // Unlock overlay
            setTimeout(()=>{
                document.getElementById('unlock-overlay').classList.add('active');
            },1000);

            // â”€â”€ Smooth transition to Scene 2 â”€â”€
            // Step 1: Lock dissolves away
            setTimeout(()=>{
                document.querySelector('.lock-wrap').classList.add('dissolving');
            },2800);

            // Step 2: Dark curtain rises
            setTimeout(()=>{
                document.getElementById('unlock-overlay').classList.remove('active');
                document.getElementById('dark-curtain').classList.add('active');
            },3500);

            // Step 3: Switch scenes while curtain is fully dark
            setTimeout(()=>{
                document.getElementById('scene-1').classList.remove('active');
                document.getElementById('scene-1').style.display='none';
                document.getElementById('scene-2').classList.add('active');
                document.querySelector('.vinyl-scene').classList.add('entering');
            },5000);

            // Step 4: Curtain fades away revealing scene 2
            setTimeout(()=>{
                document.getElementById('dark-curtain').classList.remove('active');
            },5300);
        }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  SCENE 2: VINYL ROULETTE
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const SONGS=[
        {title:'Teoremas',artist:'JosÃ© Madero',file:'music/JosÃ© Madero - Teoremas.mp3',emoji:'ğŸ¸'},
        {title:'Una CanciÃ³n',artist:'Los de Adentro',file:'music/Los de Adentro - Una CanciÃ³n.mp3',emoji:'ï¿½'},
        {title:'Nuestro Crimen',artist:'Nuestro Crimen',file:'music/Nuestro Crimen [oUNBRH6KLkA].mp3',emoji:'ğŸ”¥'},
        {title:'On Melancholy Hill',artist:'Gorillaz',file:'music/On Melancholy Hill.mp3',emoji:'ğŸŒŠ'},
        {title:'PrÃ©stame Tu Piel',artist:'PrÃ©stame Tu Piel',file:'music/PrÃ©stame Tu Piel.mp3',emoji:'ğŸ’‹'},
        {title:'Dandelions',artist:'Ruth B.',file:'music/Ruth B. - Dandelions (Audio).mp3',emoji:'ï¿½'},
        {title:'Luna',artist:'ZoÃ© (MTV Unplugged)',file:'music/ZoÃ© - Luna (MTV Unplugged).mp3',emoji:'ğŸŒ™'},
        {title:'ĞœĞ¾Ñ‘ ÑĞµÑ€Ğ´Ñ†Ğµ',artist:'ĞšĞ˜Ğ¢ĞĞ™ (KIT-I)',file:'music/ĞšĞ˜Ğ¢ĞĞ™ (KIT-I) - ĞœĞ¾Ñ‘ ÑĞµÑ€Ğ´Ñ†Ğµ.mp3',emoji:'ğŸ’–'},
        {title:'Ğ¡Ğ²ĞµÑ‚',artist:'Ğ¡Ğ²ĞµÑ‚',file:'music/Ğ¡Ğ²ĞµÑ‚.mp3',emoji:'âœ¨'}
    ];
    const SEG_COLORS=[
        {from:'#1a0a12',to:'#2d1018'},{from:'#120a18',to:'#251530'},
        {from:'#0f1520',to:'#1a2535'},{from:'#1a1008',to:'#2d1c10'},
        {from:'#0a1518',to:'#102d28'},{from:'#18100a',to:'#302518'},
        {from:'#140a1a',to:'#28152d'},{from:'#0a0f18',to:'#151a30'},
        {from:'#1a0f0a',to:'#2d1a10'}
    ];
    const NUM=9, ARC=Math.PI*2/NUM;
    let curAngle=0, spinning=false, vel=0, lastSeg=-1;

    const vc=document.getElementById('vinyl'),vx=vc.getContext('2d');
    const VW=vc.width,VH=vc.height,VCX=VW/2,VCY=VH/2,VR=VW/2-12;

    function drawVinyl(a){
        vx.clearRect(0,0,VW,VH);
        // Base
        vx.beginPath();vx.arc(VCX,VCY,VR,0,Math.PI*2);vx.fillStyle='#0a0610';vx.fill();
        // Grooves
        for(let r=50;r<VR;r+=8){vx.beginPath();vx.arc(VCX,VCY,r,0,Math.PI*2);
            vx.strokeStyle=r%24===0?'rgba(255,255,255,0.04)':'rgba(255,255,255,0.015)';vx.lineWidth=1;vx.stroke()}
        // Segments
        for(let i=0;i<NUM;i++){
            const sa=a+i*ARC,ea=sa+ARC;
            const g=vx.createRadialGradient(VCX,VCY,45,VCX,VCY,VR);
            g.addColorStop(0,SEG_COLORS[i].from);g.addColorStop(.6,SEG_COLORS[i].to);g.addColorStop(1,SEG_COLORS[i].from);
            vx.save();vx.beginPath();vx.moveTo(VCX,VCY);vx.arc(VCX,VCY,VR,sa,ea);vx.closePath();
            vx.fillStyle=g;vx.globalAlpha=.7;vx.fill();vx.globalAlpha=1;
            vx.beginPath();vx.moveTo(VCX,VCY);vx.lineTo(VCX+Math.cos(sa)*VR,VCY+Math.sin(sa)*VR);
            vx.strokeStyle='rgba(251,113,133,0.12)';vx.lineWidth=1.5;vx.stroke();vx.restore();
            // Text
            vx.save();vx.translate(VCX,VCY);vx.rotate(sa+ARC/2);
            vx.font='18px serif';vx.textAlign='center';vx.textBaseline='middle';
            vx.fillText(SONGS[i].emoji,VR*0.78,0);
            vx.font='bold 13px "Playfair Display",serif';vx.fillStyle='rgba(253,164,175,0.9)';
            vx.shadowColor='rgba(244,63,94,0.4)';vx.shadowBlur=8;
            vx.fillText(SONGS[i].title.substring(0,14),VR*0.50,-7);vx.shadowBlur=0;
            vx.font='9px "Inter",sans-serif';vx.fillStyle='rgba(253,164,175,0.45)';
            vx.fillText(SONGS[i].artist.substring(0,16),VR*0.50,7);vx.restore();

            // Groove lines within segment for vinyl feel
            vx.save();
            vx.beginPath();vx.moveTo(VCX,VCY);vx.arc(VCX,VCY,VR,sa,ea);vx.closePath();vx.clip();
            for(let r=60;r<VR;r+=16){
                vx.beginPath();vx.arc(VCX,VCY,r,sa,ea);
                vx.strokeStyle='rgba(251,113,133,0.03)';vx.lineWidth=0.5;vx.stroke();
            }
            vx.restore();
        }
        // Notches
        for(let i=0;i<12;i++){
            const na=a+i*(Math.PI*2/12);
            vx.save();vx.translate(VCX,VCY);vx.rotate(na);vx.beginPath();vx.moveTo(VR-6,0);vx.lineTo(VR+1,0);
            vx.strokeStyle=i%3===0?'rgba(251,113,133,0.25)':'rgba(251,113,133,0.1)';
            vx.lineWidth=i%3===0?3:1.5;vx.stroke();vx.restore()}
        // Edge & center
        vx.beginPath();vx.arc(VCX,VCY,VR,0,Math.PI*2);
        vx.strokeStyle='rgba(251,113,133,0.08)';vx.lineWidth=4;vx.stroke();
        vx.beginPath();vx.arc(VCX,VCY,42,0,Math.PI*2);vx.fillStyle='#0a0610';vx.fill();
        vx.strokeStyle='rgba(251,113,133,0.15)';vx.lineWidth=1.5;vx.stroke();
    }
    drawVinyl(0);

    const actx=new(window.AudioContext||window.webkitAudioContext)();
    function tickSnd(f){try{const o=actx.createOscillator(),g=actx.createGain();
        o.connect(g);g.connect(actx.destination);o.frequency.value=f||1200;o.type='triangle';
        g.gain.setValueAtTime(.04,actx.currentTime);g.gain.exponentialRampToValueAtTime(.001,actx.currentTime+.06);
        o.start();o.stop(actx.currentTime+.06)}catch(e){}}

    function getSeg(a){let n=(-Math.PI/2-a)%(Math.PI*2);if(n<0)n+=Math.PI*2;return Math.floor(n/ARC)%NUM}

    document.getElementById('spin-hub').addEventListener('click',()=>{
        if(spinning)return;spinning=true;
        document.getElementById('spin-hub').classList.add('disabled');
        vel=14+Math.random()*14;
        function anim(){
            curAngle+=vel*0.016;vel*=0.984;drawVinyl(curAngle);
            const s=getSeg(curAngle);
            if(s!==lastSeg){lastSeg=s;tickSnd(800+s*150);
                const nd=document.getElementById('needle-ptr');nd.classList.add('tick');
                setTimeout(()=>nd.classList.remove('tick'),60)}
            if(vel>0.12){requestAnimationFrame(anim)}
            else{vel=0;spinning=false;
                document.getElementById('spin-hub').classList.remove('disabled');
                const w=getSeg(curAngle);
                setTimeout(()=>selectSong(w),800)}
        }
        requestAnimationFrame(anim);
    });

    function selectSong(idx){
        const song=SONGS[idx];
        document.getElementById('tonearm').classList.add('playing');
        // Spawn notes
        const ns=['ğŸµ','ğŸ¶','â™ª','â™«','ğŸ’•','âœ¨'];
        for(let i=0;i<12;i++){const n=document.createElement('div');n.className='note-particle';
            n.textContent=ns[Math.floor(Math.random()*ns.length)];
            n.style.left=(20+Math.random()*60)+'%';n.style.top=(30+Math.random()*40)+'%';
            n.style.animationDelay=Math.random()+'s';document.body.appendChild(n);
            setTimeout(()=>n.remove(),4000)}

        // Show result overlay & start music
        setTimeout(()=>{
            document.getElementById('result-song').textContent=song.title;
            document.getElementById('result-artist').textContent=song.artist;
            document.getElementById('result-overlay').classList.add('active');

            // Start music now â€” when "Reproduciendo..." shows
            const player = document.getElementById('music-player');
            player.src = song.file;
            player.play().catch(()=>{
                document.addEventListener('click',()=>player.play().catch(()=>{}),{once:true});
            });
        },500);

        // Set song info for scene 3
        document.getElementById('np-song').textContent=song.title;
        document.getElementById('np-artist').textContent=song.artist;

        // â”€â”€ Result vinyl flies to now-playing â”€â”€
        setTimeout(()=>{
            const vinylIcon = document.getElementById('result-vinyl-icon');
            const vRect = vinylIcon.getBoundingClientRect();

            // Fix vinyl icon position for free animation
            vinylIcon.style.left = vRect.left + 'px';
            vinylIcon.style.top = vRect.top + 'px';
            vinylIcon.style.width = vRect.width + 'px';
            vinylIcon.style.height = vRect.height + 'px';
            vinylIcon.classList.add('flying');

            // Fade out the text content (song name, artist, EQ)
            document.getElementById('result-song').classList.add('result-text-fade');
            document.getElementById('result-artist').classList.add('result-text-fade');
            document.querySelector('.eq-bars').classList.add('result-text-fade');
            document.querySelector('.result-label').classList.add('result-text-fade');

            // Activate scene 3 behind the overlay (still hidden by overlay bg)
            document.getElementById('scene-2').classList.remove('active');
            document.getElementById('scene-2').style.display = 'none';
            document.getElementById('scene-3').classList.add('active');
            const vid = document.getElementById('video-bg');
            vid.play().catch(()=>{});

            // Wait a frame so scene-3 layout computes, then measure np-vinyl
            requestAnimationFrame(()=>{
                requestAnimationFrame(()=>{
                    const npVinyl = document.getElementById('np-vinyl');
                    const npRect = npVinyl.getBoundingClientRect();

                    // Dissolve overlay bg to reveal video underneath
                    document.getElementById('result-overlay').classList.add('bg-fade');

                    // Fly the vinyl to its target
                    setTimeout(()=>{
                        vinylIcon.style.left = npRect.left + 'px';
                        vinylIcon.style.top = npRect.top + 'px';
                        vinylIcon.style.width = npRect.width + 'px';
                        vinylIcon.style.height = npRect.height + 'px';
                        vinylIcon.style.border = '2px solid rgba(251,113,133,0.15)';
                    },200);



                    // Clean up after flight completes
                    setTimeout(()=>{
                        vinylIcon.style.display = 'none';
                        document.getElementById('result-overlay').classList.remove('active','bg-fade');
                        document.getElementById('result-overlay').style.display = 'none';

                        // Create petals
                        const petals=['ğŸŒ¸','ğŸ©·','âœ¿','â€','ğŸª·'];
                        for(let i=0;i<15;i++){const p=document.createElement('div');p.className='petal';
                            p.textContent=petals[Math.floor(Math.random()*petals.length)];
                            p.style.left=Math.random()*100+'%';p.style.fontSize=(.8+Math.random())+'rem';
                            p.style.animationDuration=(10+Math.random()*15)+'s';
                            p.style.animationDelay=Math.random()*12+'s';
                            document.getElementById('scene-3').appendChild(p)}

                        // Start lily bloom animation
                        startLilyBloom();
                    },4000);
                });
            });
        },3500);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  COUNTDOWN TIMER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function updateCountdown(){
        const valentine = new Date('2026-02-14T00:00:00');
        const now = new Date();
        const diff = valentine - now;
        if(diff <= 0){
            document.getElementById('countdown-boxes').innerHTML =
                '<div class="cd-arrived">ğŸ’ Â¡Hoy es San ValentÃ­n! ğŸ’</div>';
            return;
        }
        const d = Math.floor(diff / 86400000);
        const h = Math.floor((diff % 86400000) / 3600000);
        const m = Math.floor((diff % 3600000) / 60000);
        const s = Math.floor((diff % 60000) / 1000);
        document.getElementById('cd-days').textContent = d;
        document.getElementById('cd-hours').textContent = h;
        document.getElementById('cd-mins').textContent = String(m).padStart(2,'0');
        document.getElementById('cd-secs').textContent = String(s).padStart(2,'0');
    }
    updateCountdown();
    setInterval(updateCountdown, 1000);

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  EVASIVE "NO" BUTTON
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const btnNo = document.getElementById('btn-no');
    const btnSi = document.getElementById('btn-si');
    const noMsg = document.getElementById('no-msg');
    let noAttempts = 0;
    const noMessages = [
        'Â¿Segura? ğŸ¥º PiÃ©nsalo bien...',
        'Â¡No es una opciÃ³n vÃ¡lida! ğŸ˜¤',
        'Â¿EstÃ¡s bromeando verdad? ğŸ˜…',
        'Error 404: "No" no encontrado ğŸ’»',
        'Â¡Mi corazÃ³n no acepta esa respuesta! ğŸ’”',
        'DiagnÃ³stico: necesitas decir SÃ­ ğŸ©º',
        'Â¡Receta mÃ©dica: 1 SÃ­ cada 24hrs! ğŸ’Š',
        'Ese botÃ³n no sirve, prueba el otro ğŸ˜',
        'Contraindicado: decir No al amor ğŸ“‹',
        'Â¡Paciente en negaciÃ³n! Stat: SÃ­ ğŸ¥',
        'No insistas que me voy a esconder ğŸ‘»',
        'Te quiero... Â¿y tÃº? Solo di SÃ­ ğŸ¥¹'
    ];

    function handleNo(){
        noAttempts++;

        // Show funny message
        noMsg.textContent = noMessages[Math.min(noAttempts-1, noMessages.length-1)];
        noMsg.classList.add('show');
        setTimeout(()=> noMsg.classList.remove('show'), 2800);

        // Shake the No button
        btnNo.style.animation = 'none';
        btnNo.offsetHeight; // trigger reflow
        btnNo.style.animation = 'shakeNo 0.5s ease';

        // Make SÃ­ button grow with each attempt
        const grow = 1 + noAttempts * 0.04;
        btnSi.style.transform = `scale(${grow})`;

        // After 6 attempts, show the payment overlay!
        if(noAttempts >= 6){
            btnNo.style.opacity = '0.3';
            btnNo.style.pointerEvents = 'none';
            setTimeout(()=>{
                document.getElementById('payment-overlay').classList.add('active');
            }, 800);
        }
    }

    // Payment form joke interactions
    document.getElementById('btn-pay').addEventListener('click', ()=>{
        document.getElementById('pay-form').style.display = 'none';
        document.getElementById('pay-result').classList.add('active');
    });
    document.getElementById('btn-accept-love').addEventListener('click', ()=>{
        document.getElementById('payment-overlay').classList.remove('active');
        // Trigger love reveal
        btnSi.click();
    });
    // Format card number with spaces
    document.getElementById('pay-card-num').addEventListener('input', function(e){
        let v = this.value.replace(/\D/g,'').substring(0,16);
        this.value = v.replace(/(\d{4})(?=\d)/g, '$1 ');
    });

    // Only click triggers No logic
    btnNo.addEventListener('click', e => { e.preventDefault(); handleNo(); });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  "SÃ" BUTTON - LOVE REVEAL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    btnSi.addEventListener('click', ()=>{
        const reveal = document.getElementById('love-reveal');
        reveal.classList.add('active');

        // Emoji rain
        const emojis = ['ğŸ’–','ğŸ’•','â¤ï¸','ğŸŒ¹','ğŸ’','âœ¨','ğŸ©·','ğŸ’—','ğŸ’“','ğŸ¥°','ğŸ˜','ğŸŒ¸','ğŸ’','ğŸ’'];
        const rainContainer = document.getElementById('love-emoji-rain');
        for(let i = 0; i < 40; i++){
            const drop = document.createElement('div');
            drop.className = 'love-emoji-drop';
            drop.textContent = emojis[Math.floor(Math.random()*emojis.length)];
            drop.style.left = Math.random()*100 + '%';
            drop.style.fontSize = (1 + Math.random()*1.5) + 'rem';
            drop.style.animationDuration = (3 + Math.random()*4) + 's';
            drop.style.animationDelay = Math.random()*3 + 's';
            rainContainer.appendChild(drop);
        }

        // Vibrate if available
        if(navigator.vibrate) navigator.vibrate([100,50,100,50,200]);
    });

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  LILY FLOWER ANIMATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    const lilyC = document.getElementById('lily-canvas');
    const lx = lilyC.getContext('2d');
    const LW = lilyC.width, LH = lilyC.height;
    const LCX = LW/2, LCY = LH/2;
    let lilyBloom = 0; // 0 = closed, 1 = fully open
    let lilyRunning = false;
    let lilyTime = 0;
    const lilySparkles = [];

    // Petal shape using bezier curves (inspired by changhuixu/canvas-animation-step-by-step)
    function drawPetal(ctx, cx, cy, angle, length, width, bloom, layer){
        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(angle);

        // Petal opens outward as bloom increases
        const openAngle = bloom * 0.35;
        ctx.rotate(-openAngle);

        const petalLen = length * (0.3 + bloom * 0.7);
        const petalW = width * (0.2 + bloom * 0.8);
        const curveOut = petalW * 0.75;

        // Main petal shape
        ctx.beginPath();
        ctx.moveTo(0, 0);
        // Right side - quadratic curve
        ctx.bezierCurveTo(
            curveOut, -petalLen * 0.3,
            petalW * 1.1, -petalLen * 0.65,
            petalW * 0.15, -petalLen
        );
        // Petal tip - slight point
        ctx.bezierCurveTo(
            0, -petalLen * 1.06,
            -petalW * 0.05, -petalLen * 1.06,
            -petalW * 0.15, -petalLen
        );
        // Left side
        ctx.bezierCurveTo(
            -petalW * 1.1, -petalLen * 0.65,
            -curveOut, -petalLen * 0.3,
            0, 0
        );
        ctx.closePath();

        // Gradient fill - white/pink lily colors
        const grad = ctx.createLinearGradient(0, 0, 0, -petalLen);
        if(layer === 0){
            grad.addColorStop(0, 'rgba(255,235,240,0.95)');
            grad.addColorStop(0.3, 'rgba(255,220,230,0.9)');
            grad.addColorStop(0.7, 'rgba(255,200,215,0.85)');
            grad.addColorStop(1, 'rgba(255,240,245,0.92)');
        } else {
            grad.addColorStop(0, 'rgba(255,225,235,0.9)');
            grad.addColorStop(0.3, 'rgba(255,200,218,0.88)');
            grad.addColorStop(0.7, 'rgba(253,180,200,0.85)');
            grad.addColorStop(1, 'rgba(255,230,240,0.9)');
        }
        ctx.fillStyle = grad;
        ctx.fill();

        // Petal vein (center line)
        ctx.beginPath();
        ctx.moveTo(0, -petalLen * 0.08);
        ctx.quadraticCurveTo(petalW * 0.02, -petalLen * 0.5, 0, -petalLen * 0.92);
        ctx.strokeStyle = 'rgba(220,160,180,0.35)';
        ctx.lineWidth = 1;
        ctx.stroke();

        // Side veins
        for(let v = 0.25; v < 0.8; v += 0.18){
            const vy = -petalLen * v;
            const vw = petalW * (0.4 - Math.abs(v-0.5)*0.4);
            ctx.beginPath();
            ctx.moveTo(0, vy);
            ctx.quadraticCurveTo(vw*0.5, vy - petalLen*0.06, vw*0.8, vy - petalLen*0.03);
            ctx.strokeStyle = 'rgba(220,160,180,0.2)';
            ctx.lineWidth = 0.5;
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(0, vy);
            ctx.quadraticCurveTo(-vw*0.5, vy - petalLen*0.06, -vw*0.8, vy - petalLen*0.03);
            ctx.stroke();
        }

        // Subtle pink spots on petals (lily characteristic)
        if(bloom > 0.5){
            const spotAlpha = (bloom - 0.5) * 2 * 0.35;
            for(let s = 0; s < 5; s++){
                const sx = (Math.sin(s*2.7+angle*3)) * petalW * 0.35;
                const sy = -petalLen * (0.3 + s * 0.1);
                ctx.beginPath();
                ctx.arc(sx, sy, 1.5 + Math.sin(s)*0.8, 0, Math.PI*2);
                ctx.fillStyle = `rgba(220,80,120,${spotAlpha})`;
                ctx.fill();
            }
        }

        // Soft edge glow
        ctx.strokeStyle = 'rgba(255,220,235,0.25)';
        ctx.lineWidth = 0.8;
        // Retrace petal outline for stroke
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.bezierCurveTo(curveOut, -petalLen*0.3, petalW*1.1, -petalLen*0.65, petalW*0.15, -petalLen);
        ctx.bezierCurveTo(0, -petalLen*1.06, -petalW*0.05, -petalLen*1.06, -petalW*0.15, -petalLen);
        ctx.bezierCurveTo(-petalW*1.1, -petalLen*0.65, -curveOut, -petalLen*0.3, 0, 0);
        ctx.stroke();

        ctx.restore();
    }

    function drawStamen(ctx, cx, cy, angle, len, bloom){
        if(bloom < 0.4) return;
        const alpha = Math.min(1, (bloom - 0.4) * 2.5);
        ctx.save();
        ctx.translate(cx, cy);
        ctx.rotate(angle);
        ctx.globalAlpha = alpha;

        // Filament (thin line)
        const fLen = len * bloom * 0.7;
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.quadraticCurveTo(2, -fLen*0.5, 1, -fLen);
        ctx.strokeStyle = 'rgba(180,220,140,0.7)';
        ctx.lineWidth = 1.2;
        ctx.stroke();

        // Anther (small oval at tip)
        ctx.beginPath();
        ctx.ellipse(1, -fLen, 3, 5, 0, 0, Math.PI*2);
        ctx.fillStyle = 'rgba(180,120,50,0.85)';
        ctx.fill();
        ctx.strokeStyle = 'rgba(140,90,30,0.5)';
        ctx.lineWidth = 0.5;
        ctx.stroke();

        ctx.globalAlpha = 1;
        ctx.restore();
    }

    function drawLilyCenter(ctx, cx, cy, bloom){
        if(bloom < 0.2) return;
        const alpha = Math.min(1, (bloom-0.2)*1.5);
        // Pistil center glow
        const cg = ctx.createRadialGradient(cx, cy, 0, cx, cy, 14*bloom);
        cg.addColorStop(0, `rgba(200,230,140,${0.6*alpha})`);
        cg.addColorStop(0.5, `rgba(180,210,120,${0.3*alpha})`);
        cg.addColorStop(1, `rgba(160,200,100,0)`);
        ctx.beginPath();
        ctx.arc(cx, cy, 14*bloom, 0, Math.PI*2);
        ctx.fillStyle = cg;
        ctx.fill();

        // Pistil dot
        ctx.beginPath();
        ctx.arc(cx, cy, 3*bloom, 0, Math.PI*2);
        ctx.fillStyle = `rgba(140,180,80,${0.8*alpha})`;
        ctx.fill();
    }

    function drawLilySparkles(ctx, time){
        lilySparkles.forEach(s => {
            s.life -= 0.005;
            if(s.life <= 0){ // respawn
                s.x = LCX + (Math.random()-0.5)*500;
                s.y = LCY + (Math.random()-0.5)*500 - 50;
                s.life = 0.5 + Math.random()*0.5;
                s.size = 0.8 + Math.random()*1.5;
            }
            s.y -= 0.15;
            s.x += Math.sin(time*2 + s.phase)*0.3;
            const alpha = Math.sin(s.life * Math.PI) * 0.6;
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.size, 0, Math.PI*2);
            ctx.fillStyle = `rgba(255,230,245,${alpha})`;
            ctx.fill();
            // Soft glow
            ctx.beginPath();
            ctx.arc(s.x, s.y, s.size*3, 0, Math.PI*2);
            ctx.fillStyle = `rgba(255,200,230,${alpha*0.15})`;
            ctx.fill();
        });
    }

    function drawLily(bloom, time){
        lx.clearRect(0, 0, LW, LH);

        const sway = Math.sin(time*0.8)*2;
        const cx = LCX + sway;
        const cy = LCY + 20;

        // Soft ambient glow behind flower
        const ambGlow = lx.createRadialGradient(cx, cy-50, 0, cx, cy-50, 300);
        ambGlow.addColorStop(0, `rgba(255,200,220,${0.18*bloom})`);
        ambGlow.addColorStop(0.5, `rgba(244,63,94,${0.07*bloom})`);
        ambGlow.addColorStop(1, 'rgba(0,0,0,0)');
        lx.beginPath();
        lx.arc(cx, cy-50, 300, 0, Math.PI*2);
        lx.fillStyle = ambGlow;
        lx.fill();

        // Short stem
        if(bloom > 0.1){
            const stemAlpha = Math.min(1, bloom*2);
            lx.save();
            lx.translate(cx, cy);
            lx.rotate(sway*0.005);
            lx.beginPath();
            lx.moveTo(0, 20);
            lx.quadraticCurveTo(4, 110, -3, 230);
            lx.strokeStyle = `rgba(80,130,60,${0.6*stemAlpha})`;
            lx.lineWidth = 6;
            lx.lineCap = 'round';
            lx.stroke();

            // Small leaf on stem
            if(bloom > 0.3){
                const leafA = Math.min(1, (bloom-0.3)*3);
                lx.beginPath();
                lx.moveTo(-3, 140);
                lx.bezierCurveTo(-45, 110, -65, 125, -48, 155);
                lx.bezierCurveTo(-35, 165, -8, 150, -3, 140);
                lx.fillStyle = `rgba(90,150,65,${0.5*leafA})`;
                lx.fill();
                // Right leaf
                lx.beginPath();
                lx.moveTo(3, 170);
                lx.bezierCurveTo(40, 145, 58, 158, 44, 182);
                lx.bezierCurveTo(30, 192, 8, 178, 3, 170);
                lx.fillStyle = `rgba(80,140,55,${0.45*leafA})`;
                lx.fill();
            }
            lx.restore();
        }

        // Back petal layer (3 petals)
        for(let i = 0; i < 3; i++){
            const angle = (i * Math.PI*2/3) - Math.PI/2 + Math.sin(time+i)*0.03;
            drawPetal(lx, cx, cy, angle, 220, 80, bloom, 1);
        }

        // Front petal layer (3 petals, offset by 60Â°)
        for(let i = 0; i < 3; i++){
            const angle = (i * Math.PI*2/3) - Math.PI/2 + Math.PI/3 + Math.sin(time*1.1+i)*0.03;
            drawPetal(lx, cx, cy, angle, 210, 72, bloom, 0);
        }

        // Stamens (6)
        for(let i = 0; i < 6; i++){
            const sAngle = (i * Math.PI*2/6) - Math.PI/2 + Math.PI/6 + Math.sin(time*0.7+i)*0.04;
            drawStamen(lx, cx, cy, sAngle, 130, bloom);
        }

        // Center
        drawLilyCenter(lx, cx, cy, bloom);

        // Sparkles
        if(bloom > 0.5){
            drawLilySparkles(lx, time);
        }
    }

    // Init sparkles
    for(let i=0; i<40; i++){
        lilySparkles.push({
            x: LCX + (Math.random()-0.5)*500,
            y: LCY + (Math.random()-0.5)*500 - 50,
            size: 1.2 + Math.random()*2.5,
            life: Math.random(),
            phase: Math.random()*Math.PI*2
        });
    }

    function startLilyBloom(){
        if(lilyRunning) return;
        lilyRunning = true;
        lilyBloom = 0;
        lilyTime = 0;
        const bloomDuration = 4; // seconds

        function animLily(){
            lilyTime += 0.016;
            if(lilyBloom < 1){
                lilyBloom = Math.min(1, lilyTime / bloomDuration);
                // Ease-out for smooth bloom
                lilyBloom = 1 - Math.pow(1 - lilyBloom, 3);
            }
            drawLily(lilyBloom, lilyTime);
            requestAnimationFrame(animLily);
        }
        requestAnimationFrame(animLily);
    }

    // Draw initial closed state
    drawLily(0, 0);

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  HELLO KITTY CANVAS DRAWINGS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function drawKitty(canvas, bowColor, bowSide){
        const ctx = canvas.getContext('2d');
        const w = canvas.width, h = canvas.height;
        const cx = w/2, cy = h*0.52;
        const r = w*0.32; // head radius
        ctx.clearRect(0,0,w,h);

        // Soft glow behind
        const glow = ctx.createRadialGradient(cx, cy, r*0.3, cx, cy, r*1.8);
        glow.addColorStop(0, 'rgba(255,192,203,0.12)');
        glow.addColorStop(1, 'rgba(255,192,203,0)');
        ctx.fillStyle = glow;
        ctx.fillRect(0,0,w,h);

        ctx.save();

        // â”€â”€ LEFT EAR â”€â”€
        ctx.beginPath();
        ctx.moveTo(cx - r*0.65, cy - r*0.55);
        ctx.lineTo(cx - r*0.85, cy - r*1.35);
        ctx.lineTo(cx - r*0.15, cy - r*0.75);
        ctx.closePath();
        ctx.fillStyle = '#fff';
        ctx.fill();
        ctx.strokeStyle = 'rgba(180,140,160,0.35)';
        ctx.lineWidth = r*0.04;
        ctx.stroke();
        // Inner ear
        ctx.beginPath();
        ctx.moveTo(cx - r*0.6, cy - r*0.6);
        ctx.lineTo(cx - r*0.75, cy - r*1.15);
        ctx.lineTo(cx - r*0.2, cy - r*0.72);
        ctx.closePath();
        ctx.fillStyle = 'rgba(255,182,193,0.25)';
        ctx.fill();

        // â”€â”€ RIGHT EAR â”€â”€
        ctx.beginPath();
        ctx.moveTo(cx + r*0.65, cy - r*0.55);
        ctx.lineTo(cx + r*0.85, cy - r*1.35);
        ctx.lineTo(cx + r*0.15, cy - r*0.75);
        ctx.closePath();
        ctx.fillStyle = '#fff';
        ctx.fill();
        ctx.strokeStyle = 'rgba(180,140,160,0.35)';
        ctx.lineWidth = r*0.04;
        ctx.stroke();
        // Inner ear
        ctx.beginPath();
        ctx.moveTo(cx + r*0.6, cy - r*0.6);
        ctx.lineTo(cx + r*0.75, cy - r*1.15);
        ctx.lineTo(cx + r*0.2, cy - r*0.72);
        ctx.closePath();
        ctx.fillStyle = 'rgba(255,182,193,0.25)';
        ctx.fill();

        // â”€â”€ HEAD (round) â”€â”€
        ctx.beginPath();
        ctx.arc(cx, cy, r, 0, Math.PI*2);
        ctx.fillStyle = '#fff';
        ctx.fill();
        ctx.strokeStyle = 'rgba(180,140,160,0.3)';
        ctx.lineWidth = r*0.04;
        ctx.stroke();

        // â”€â”€ EYES (oval, Hello Kitty style) â”€â”€
        ctx.fillStyle = '#1a1a1a';
        ctx.beginPath();
        ctx.ellipse(cx - r*0.32, cy - r*0.05, r*0.09, r*0.12, 0, 0, Math.PI*2);
        ctx.fill();
        ctx.beginPath();
        ctx.ellipse(cx + r*0.32, cy - r*0.05, r*0.09, r*0.12, 0, 0, Math.PI*2);
        ctx.fill();

        // Eye highlights
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(cx - r*0.28, cy - r*0.1, r*0.04, 0, Math.PI*2);
        ctx.fill();
        ctx.beginPath();
        ctx.arc(cx + r*0.36, cy - r*0.1, r*0.04, 0, Math.PI*2);
        ctx.fill();

        // â”€â”€ NOSE (small yellow oval) â”€â”€
        ctx.beginPath();
        ctx.ellipse(cx, cy + r*0.15, r*0.08, r*0.06, 0, 0, Math.PI*2);
        ctx.fillStyle = '#f5c542';
        ctx.fill();
        ctx.strokeStyle = 'rgba(200,160,50,0.3)';
        ctx.lineWidth = r*0.02;
        ctx.stroke();

        // â”€â”€ WHISKERS â”€â”€
        ctx.strokeStyle = 'rgba(140,110,120,0.45)';
        ctx.lineWidth = r*0.03;
        ctx.lineCap = 'round';
        // Left whiskers
        [[- 0.45, 0.05, -1.05, -0.1],
         [-0.45, 0.15, -1.05, 0.15],
         [-0.45, 0.25, -1.05, 0.4]].forEach(([x1,y1,x2,y2])=>{
            ctx.beginPath();
            ctx.moveTo(cx + x1*r, cy + y1*r);
            ctx.lineTo(cx + x2*r, cy + y2*r);
            ctx.stroke();
        });
        // Right whiskers
        [[0.45, 0.05, 1.05, -0.1],
         [0.45, 0.15, 1.05, 0.15],
         [0.45, 0.25, 1.05, 0.4]].forEach(([x1,y1,x2,y2])=>{
            ctx.beginPath();
            ctx.moveTo(cx + x1*r, cy + y1*r);
            ctx.lineTo(cx + x2*r, cy + y2*r);
            ctx.stroke();
        });

        // â”€â”€ BLUSH CIRCLES â”€â”€
        ctx.beginPath();
        ctx.ellipse(cx - r*0.55, cy + r*0.2, r*0.12, r*0.08, 0, 0, Math.PI*2);
        ctx.fillStyle = 'rgba(255,150,170,0.2)';
        ctx.fill();
        ctx.beginPath();
        ctx.ellipse(cx + r*0.55, cy + r*0.2, r*0.12, r*0.08, 0, 0, Math.PI*2);
        ctx.fillStyle = 'rgba(255,150,170,0.2)';
        ctx.fill();

        // â”€â”€ BOW â”€â”€
        const bDir = bowSide === 'left' ? -1 : 1;
        const bx = cx + bDir * r*0.7;
        const by = cy - r*0.95;

        // Left ribbon loop
        ctx.beginPath();
        ctx.ellipse(bx - r*0.2, by + r*0.05, r*0.22, r*0.15, -0.2*bDir, 0, Math.PI*2);
        ctx.fillStyle = bowColor;
        ctx.fill();
        // Right ribbon loop
        ctx.beginPath();
        ctx.ellipse(bx + r*0.2, by - r*0.05, r*0.22, r*0.15, -0.2*bDir, 0, Math.PI*2);
        ctx.fillStyle = bowColor;
        ctx.fill();
        // Center knot
        ctx.beginPath();
        ctx.arc(bx, by, r*0.1, 0, Math.PI*2);
        ctx.fillStyle = bowColor;
        ctx.fill();
        // Ribbon outlines
        ctx.strokeStyle = 'rgba(0,0,0,0.1)';
        ctx.lineWidth = r*0.02;
        ctx.beginPath();
        ctx.arc(bx, by, r*0.1, 0, Math.PI*2);
        ctx.stroke();
        // Bow highlight
        ctx.beginPath();
        ctx.ellipse(bx - r*0.15, by - r*0.02, r*0.06, r*0.03, -0.5, 0, Math.PI*2);
        ctx.fillStyle = 'rgba(255,255,255,0.3)';
        ctx.fill();
        ctx.beginPath();
        ctx.ellipse(bx + r*0.15, by - r*0.08, r*0.06, r*0.03, -0.5, 0, Math.PI*2);
        ctx.fillStyle = 'rgba(255,255,255,0.3)';
        ctx.fill();

        ctx.restore();
    }

    // Draw all floating kitties with different bow colors and sides
    const kittyConfigs = [
        {color:'#fb7185', side:'right'},
        {color:'#f43f5e', side:'left'},
        {color:'#ec4899', side:'right'},
        {color:'#f472b6', side:'left'},
        {color:'#fb7185', side:'right'},
        {color:'#f43f5e', side:'left'},
        {color:'#ec4899', side:'right'},
        {color:'#f472b6', side:'left'}
    ];
    for(let i = 1; i <= 8; i++){
        const kc = document.getElementById('kitty-'+i);
        drawKitty(kc, kittyConfigs[i-1].color, kittyConfigs[i-1].side);
        kc.style.left = (3 + Math.random()*88) + '%';
        kc.style.bottom = -(5 + Math.random()*25) + '%';
        kc.style.animationDuration = (20 + Math.random()*18) + 's';
        kc.style.animationDelay = (Math.random()*14) + 's';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    //  SHARED SYSTEMS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function clickSound(){try{const o=actx.createOscillator(),g=actx.createGain();
        o.connect(g);g.connect(actx.destination);o.frequency.value=800+Math.random()*400;o.type='sine';
        g.gain.setValueAtTime(.05,actx.currentTime);g.gain.exponentialRampToValueAtTime(.001,actx.currentTime+.1);
        o.start();o.stop(actx.currentTime+.1)}catch(e){}}

    // Floating hearts
    (function(){const c=document.getElementById('hearts-container');
        const h=['â™¥','â™¡','â¤','ğŸ’•'],cl=['rgba(244,63,94,0.3)','rgba(251,113,133,0.2)','rgba(253,164,175,0.15)'];
        for(let i=0;i<18;i++){const el=document.createElement('div');el.className='floating-heart';
            el.textContent=h[Math.floor(Math.random()*h.length)];
            el.style.left=Math.random()*100+'%';el.style.fontSize=(.8+Math.random()*1.5)+'rem';
            el.style.color=cl[Math.floor(Math.random()*cl.length)];
            el.style.animationDuration=(8+Math.random()*15)+'s';
            el.style.animationDelay=Math.random()*10+'s';c.appendChild(el)}})();

    // Particles
    const pCan=document.getElementById('particles-canvas'),pCtx=pCan.getContext('2d');
    function rP(){pCan.width=innerWidth;pCan.height=innerHeight}rP();addEventListener('resize',rP);
    const pts=Array.from({length:60},()=>({x:Math.random()*innerWidth,y:Math.random()*innerHeight,
        vx:(Math.random()-.5)*.3,vy:(Math.random()-.5)*.3,s:Math.random()*2+.5,
        p:Math.random()*6.28,ps:.02+Math.random()*.02}));
    function aParts(){pCtx.clearRect(0,0,pCan.width,pCan.height);
        pts.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.p+=p.ps;
            if(p.x<0||p.x>pCan.width)p.x=Math.random()*pCan.width;
            if(p.y<0||p.y>pCan.height)p.y=Math.random()*pCan.height;
            const o=.08+Math.sin(p.p)*.12+.12;
            pCtx.beginPath();pCtx.arc(p.x,p.y,p.s,0,Math.PI*2);
            pCtx.fillStyle=`hsla(${340+Math.random()*20},75%,62%,${o})`;pCtx.fill()});
        // Connection lines between nearby particles
        for(let i=0;i<pts.length;i++){
            for(let j=i+1;j<pts.length;j++){
                const dx=pts[i].x-pts[j].x, dy=pts[i].y-pts[j].y;
                const dist=Math.sqrt(dx*dx+dy*dy);
                if(dist<120){
                    pCtx.beginPath();pCtx.moveTo(pts[i].x,pts[i].y);
                    pCtx.lineTo(pts[j].x,pts[j].y);
                    pCtx.strokeStyle=`rgba(251,113,133,${(1-dist/120)*0.06})`;
                    pCtx.lineWidth=0.5;pCtx.stroke();
                }
            }
        }
        requestAnimationFrame(aParts)}aParts();

    // Keyboard for lock
    let fDial=0;
    document.addEventListener('keydown',e=>{if(isUnlocked)return;
        if(e.key==='ArrowRight'){e.preventDefault();fDial=(fDial+1)%4}
        else if(e.key==='ArrowLeft'){e.preventDefault();fDial=(fDial-1+4)%4}
        else if(e.key==='ArrowUp'||e.key==='ArrowDown'){e.preventDefault();
            currentValues[fDial]=(currentValues[fDial]+(e.key==='ArrowDown'?1:-1)+10)%10;
            const s=document.getElementById(`strip-${fDial}`);
            s.style.transition='transform .3s cubic-bezier(.34,1.56,.64,1)';
            s.style.transform=`translateY(${(60/2)-((currentValues[fDial]+1)*DH+DH/2)}px)`;
            clickSound();updateDots();checkCode()}});

    // Triple-tap hint
    let taps=0,tTimer=null;
    document.getElementById('lock-body').addEventListener('click',e=>{
        if(e.target.closest('.dial'))return;taps++;
        if(taps===1)tTimer=setTimeout(()=>{taps=0},500);
        else if(taps>=3){clearTimeout(tTimer);taps=0;
            const h=document.querySelector('.hint-text');
            h.textContent='ğŸ’¡ Pista: 2-3-0-1';h.style.color='rgba(234,179,8,0.7)';
            setTimeout(()=>{h.textContent='Ingresa el cÃ³digo secreto';h.style.color=''},3000)}});

    // Console surprise messages
    console.log('%cğŸ’– Feliz San ValentÃ­n ğŸ’–', 'font-size:24px;color:#f43f5e;font-weight:bold;text-shadow:0 0 10px rgba(244,63,94,0.5)');
    console.log('%cEsta pÃ¡gina fue hecha con mucho amor â¤ï¸', 'font-size:14px;color:#fda4af;font-style:italic');
    console.log('%cÂ¿Encontraste el easter egg? ğŸ˜‰', 'font-size:12px;color:#fb7185');
    </script>
</body>
</html>
